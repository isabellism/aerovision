<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AeroVision 1.1.1 - FINAL 3D</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        /* O vídeo da câmera fica no fundo */
        #webcam-feed {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 1;
        }
        /* A cena 3D fica transparente por cima */
        a-scene {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2; pointer-events: none; /* Deixa o toque passar para o botão */
        }
        #btn {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            padding: 20px; background: #00AAFF; color: white; border: none;
            border-radius: 10px; z-index: 9999; font-weight: bold; font-size: 16px;
        }
    </style>
</head>
<body>

    <button id="btn">INICIAR REALIDADE MISTA 3D</button>

    <video id="webcam-feed" autoplay playsinline muted></video>

    <a-scene vr-mode-ui="enabled: false" background="color: transparent;">
        
        <a-box position="0 0 -3" 
               rotation="0 45 0" 
               color="#00AAFF" 
               opacity="0.9"
               animation="property: rotation; to: 0 405 0; loop: true; dur: 5000; easing: linear">
        </a-box>
        
        <a-light type="directional" position="1 2 1" intensity="1.5"></a-light>
        <a-light type="ambient" color="#CCC"></a-light>

        <a-entity id="stereo-rig">
            <a-camera position="-0.03 1.6 0" camera="viewport: 0 0 0.5 1; active: false;"></a-camera>
            
            <a-camera position="0.03 1.6 0" camera="viewport: 0.5 0 0.5 1; active: true;"></a-camera>
        </a-entity>

    </a-scene>

    <script>
        const btn = document.getElementById('btn');
        const video = document.getElementById('webcam-feed');
        const rig = document.getElementById('stereo-rig');

        btn.addEventListener('click', function() {
            // 1. Inicia a Câmera do iPhone
            navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' } 
            }).then(function(stream) {
                video.srcObject = stream;
                video.play();
                btn.style.display = 'none';
                
                // ATIVAR AS DUAS CÂMERAS 3D
                // Precisamos ativar as duas câmeras manualmente pois não estamos no modo VR nativo
                rig.children[0].setAttribute('camera', 'active', true);
                rig.children[1].setAttribute('camera', 'active', true);

            }).catch(err => {
                alert("Erro na câmera: Verifique as permissões no Safari.");
            });
        });
    </script>
</body>
</html>
